(this["webpackJsonpbullet-note"]=this["webpackJsonpbullet-note"]||[]).push([[0],{346:function(e,t,a){e.exports=a(427)},351:function(e,t,a){},352:function(e,t,a){},426:function(e,t,a){},427:function(e,t,a){"use strict";a.r(t);var n,r=a(0),s=a.n(r),o=a(15),c=a.n(o),i=(a(351),a(352),a(281)),u=a(455),l=a(196),g=a(134),m=a(37),d=a(33),f=a(13);!function(e){e.ADD_MESSAGE="ADD_MESSAGE",e.DELETE_MESSAGE="DELETE_MESSAGE",e.SET_MESSAGE_FROM_DB="SET_MESSAGE_FROM_DB",e.TOGGLE_MESSAGE_ISDONE="TOGGLE_MESSAGE_ISDONE",e.TOGGLE_MESSAGE_ISSTAR="TOGGLE_MESSAGE_ISSTAR",e.TOGGLE_MESSAGE_ISPIN="TOGGLE_MESSAGE_ISPIN",e.EDIT_MESSAGE="EDIT_MESSAGE",e.EDIT_IT="EDIT_IT"}(n||(n={}));var E,S=a(38),v=a(27);!function(e){e.DEFAULT="DEFAULT",e.URGENT="URGENT",e.TODO="TODO",e.REVIEW="REVIEW"}(E||(E={}));var p=function(){function e(){Object(S.a)(this,e)}return Object(v.a)(e,null,[{key:"removeSpaceInStr",value:function(e){return e.replace(/\s/g,"")}},{key:"makeBasicMessage",value:function(e){var t=e.tagList,a=e.createdAt,n=t,r=a?new Date(a):new Date;return 0===t.length&&(n=[this.defaultTag]),Object(d.a)({},e,{tagList:n,createdAt:r,dateTagList:[]})}},{key:"makeTodoStatus",value:function(e){return Object(d.a)({},e)}},{key:"getTagItem",value:function(e){var t=this.removeSpaceInStr(e);return{id:t,name:t}}},{key:"getTagListFromRawMessage",value:function(e){var t=this,a=e.match(this.tagReg);return a?a.map((function(e){return t.getTagItem(e)})):[]}},{key:"getMessageType",value:function(e){var t=e.match(this.todoReg),a=e.match(this.reviewReg);return console.log(t,a),a?E.DEFAULT:t?E.TODO:void 0}},{key:"getRemovedTypeAndTagsMessage",value:function(e){var t=e;return t=(t=(t=t.replace(this.tagReg,"")).replace(this.todoReg,"")).replace(this.removeReviewPresetReg,"")}},{key:"convertRawMessageToMessageItem",value:function(e){var t=e.isDone,a=e.isPin,n=e.rawMessage,r=this.getMessageType(n),s=this.getTagListFromRawMessage(n),o=this.getRemovedTypeAndTagsMessage(n),c=this.makeBasicMessage(Object(d.a)({},e,{isPin:a,tagList:s,content:o}));switch(r){case E.TODO:var i=this.makeTodoStatus({name:"",isDone:t});return{type:E.TODO,status:i,message:c};default:return{type:E.DEFAULT,status:{},message:c}}}}]),e}();p.todoReg=/(\[\]\s)?/,p.reviewReg=/(\*(\s)?)\w+/g,p.removeReviewPresetReg=/(\*(\s))/g,p.tagReg=/#\w+(\s)?/g,p.defaultTag={id:"notDefinedTag",name:"#\u672a\u5206\u985e"};var b=p,O=function(){function e(){Object(S.a)(this,e)}return Object(v.a)(e,null,[{key:"convertMessageListToRawMessageList",value:function(e){return e.map((function(e){var t=void 0;return e.type===E.TODO&&(t=e.status.isDone),{id:e.message.id,isDone:t,rawMessage:e.message.rawMessage,createdAt:new Date(e.message.createdAt),isStared:e.message.isStared,isPin:e.message.isPin}}))}},{key:"setData",value:function(e){var t=this.convertMessageListToRawMessageList(e),a=JSON.stringify(t);localStorage.setItem("messageListLS",a)}},{key:"getData",value:function(){var e=localStorage.getItem("messageListLS");return e?JSON.parse(e):[]}}]),e}(),h=function(e,t){var a=Object(f.a)(e.messageList);switch(t.type){case n.ADD_MESSAGE:var r=e.messageList,s=0===r.length?-1:Number(r.slice(-1)[0].message.id),o=String(s+1),c=b.convertRawMessageToMessageItem({id:o,rawMessage:t.payload.rawMessage});a=[].concat(Object(f.a)(e.messageList),[c]);break;case n.SET_MESSAGE_FROM_DB:a=t.payload.rawMessageFromDBList.map((function(e){return b.convertRawMessageToMessageItem(e)}));break;case n.DELETE_MESSAGE:var i=t.payload.id;a=e.messageList.filter((function(e){return i!==e.message.id}));break;case n.TOGGLE_MESSAGE_ISDONE:var u=t.payload,l=u.id,g=u.isDone,m=a.findIndex((function(e){return e.message.id===l}));-1!==m&&a[m].type===E.TODO&&(a[m]=Object(d.a)({},a[m],{status:Object(d.a)({},a[m].status,{isDone:g})}));break;case n.TOGGLE_MESSAGE_ISSTAR:var S=t.payload,v=S.id,p=S.isStar;console.log(v,p);var h=a.findIndex((function(e){return e.message.id===v}));-1!==h&&(a[h]=Object(d.a)({},a[h],{message:Object(d.a)({},a[h].message,{isStared:p})}));break;case n.TOGGLE_MESSAGE_ISPIN:var T=t.payload,L=T.id,y=T.isPin,M=a.findIndex((function(e){return e.message.id===L}));-1!==M&&(a[M]=Object(d.a)({},a[M],{message:Object(d.a)({},a[M].message,{isPin:y})}));break;case n.EDIT_MESSAGE:var D=t.payload,k=D.id,j=D.newMessage,w=a.findIndex((function(e){return e.message.id===k}));if(-1!==w){var I=a[w].message.tagList.map((function(e){return e.id===b.defaultTag.id?"":e.name})).join(" ");a[w]=Object(d.a)({},a[w],{message:Object(d.a)({},a[w].message,{rawMessage:j+" "+I})}),console.log(a[w].message.tagList)}}return O.setData(a),a},T=Object(m.combineReducers)({messageList:h}),L=a(198),y=a.n(L),M={messageList:[]},D=Object(g.createContextValueFn)(M,T),k=Object(g.createContextStore)(M),j=y()(D,k),w=a(26),I=function(){var e=Object(r.useState)(""),t=Object(w.a)(e,2),a=t[0],n=t[1];return{handleChange:Object(r.useCallback)((function(e){var t=e.target.value;n(t)}),[]),value:a,setVal:n}},A=a(458),G=a(454),_=function(e){var t=e.value,a=e.onChange,n=e.onSendMessage;return s.a.createElement(l.a,{display:"flex",paddingTop:1},s.a.createElement(A.a,{autoFocus:!0,variant:"outlined",fullWidth:!0,value:t,onChange:a}),s.a.createElement(l.a,{paddingLeft:1},s.a.createElement(G.a,{onClick:n},"send")))},R=a(200),x=Object(m.connectCtx)(k)(void 0,(function(e){return{addMessageFn:function(t){var a=function(e){return{type:n.ADD_MESSAGE,payload:{rawMessage:e}}}(t);e(a)}}}))((function(e){var t=I(),a=t.value,n=t.setVal,o=t.handleChange,c=Object(r.useCallback)((function(){a.length>0&&(e.addMessageFn(a),n(""))}),[e,n,a]);return Object(R.useFnsByKeyCode)({lastIndex:0,confirmFn:c,escapeFn:function(){}}),s.a.createElement(_,{value:a,onChange:o,onSendMessage:c})})),C=Object(m.connectCtx)(k)((function(e){return{messageList:e.messageList}}))((function(e){var t,a=(new Date).toLocaleString();return s.a.createElement(G.a,{href:(t=e.messageList,"data:text/json;charset=utf-8,".concat(encodeURIComponent(JSON.stringify(t)))),download:"bullet-note-backup-".concat(a,".json")},"download backup")})),N=function(e){return function(t){var a=new FileReader;t.target.files&&t.target.files.length>0&&(console.log(t.target.files[0]),a.readAsText(t.target.files[0])),a.addEventListener("load",(function(t){if(t.target&&t.target.result&&"string"===typeof t.target.result){var a=JSON.parse(t.target.result);console.log(a),e&&e(a)}}))}},F=function(){return s.a.createElement("input",{type:"file",onChange:N()})},P=a(432),B=a(453),U=a(457),V=a(460),W=Object(i.a)((function(e){return{root:{cursor:"pointer",backgroundColor:"#aff",borderRadius:e.spacing(.5),"&:hover":{opacity:.8}}}})),J=function(e){var t=W();return s.a.createElement(l.a,{className:t.root,paddingLeft:.5,paddingRight:.5},e.tagName)},H=function(e){return s.a.createElement(l.a,{display:"flex",paddingLeft:.5},e.tagList.map((function(e,t){return s.a.createElement(l.a,{paddingRight:.5},s.a.createElement(J,{key:t,tagName:e.name}))})))},z=a(283),K=function(e){return s.a.createElement(l.a,null,s.a.createElement(G.a,{onClick:e.onDelete},s.a.createElement(z.a,null)))},$=a(287),q=a(288),Q=function(e,t){var a=Object(r.useState)(!!e),n=Object(w.a)(a,2),s=n[0],o=n[1],c=Object(r.useCallback)((function(){o((function(e){return!e}))}),[]);return Object(r.useEffect)((function(){t&&t(s)}),[s]),Object(r.useEffect)((function(){o(!!e)}),[e]),{toggle:s,setToggle:o,handleToggle:c}},X=function(e){var t=e.onChange,a=e.isStared,n=Q(a,t),r=n.toggle,o=n.handleToggle;return s.a.createElement(l.a,{style:{cursor:"pointer"},onClick:o},r?s.a.createElement($.a,null):s.a.createElement(q.a,null))},Y=a(284),Z=a(285),ee=function(e){var t=e.isPin,a=e.onChange,n=Q(t,a),r=n.toggle,o=n.handleToggle;return s.a.createElement(l.a,{style:{cursor:"pointer"},onClick:o},r?s.a.createElement(Y.a,null):s.a.createElement(Z.a,null))},te=function(e){var t=e.message,a=t.content,n=t.isStared,r=t.isPin,o=t.tagList,c=t.createdAt;return s.a.createElement(l.a,{display:"flex",width:"100%",justifyContent:"space-between",alignItems:"center"},s.a.createElement(l.a,{display:"flex"},s.a.createElement(B.a,{variant:"subtitle1",contentEditable:!0,onInput:e.onEditMessage},a),s.a.createElement(H,{tagList:o}),s.a.createElement(B.a,{variant:"body1",color:"textSecondary"},function(e){if("string"===typeof e)return e;var t=e.getHours(),a=e.getMinutes();return"".concat(t,":").concat(a)}(c))),s.a.createElement(l.a,{display:"flex",alignItems:"center"},s.a.createElement(X,{isStared:n,onChange:e.onStarMessage}),s.a.createElement(ee,{isPin:r,onChange:e.onPinMessage}),s.a.createElement(K,{onDelete:e.onDelete})))},ae=Object(m.connectCtx)(k)(void 0,(function(e){return{editActionFn:function(t,a){var r=function(e,t){return{type:n.EDIT_MESSAGE,payload:{id:e,newMessage:t}}}(t,a);e(r)},starActionFn:function(t,a){var r=function(e,t){return{type:n.TOGGLE_MESSAGE_ISSTAR,payload:{id:e,isStar:t}}}(t,a);e(r)},pinActionFn:function(t,a){var r=function(e,t){return{type:n.TOGGLE_MESSAGE_ISPIN,payload:{id:e,isPin:t}}}(t,a);e(r)}}}))((function(e){var t=e.editActionFn,a=e.starActionFn,n=e.pinActionFn,o=e.message.id,c=Object(r.useCallback)((function(e){var a=e.target.innerText;t(o,a)}),[t,o]),i=Object(r.useCallback)((function(e){a(o,e)}),[o,a]),u=Object(r.useCallback)((function(e){n(o,e)}),[o,n]);return s.a.createElement(te,Object.assign({},e,{onPinMessage:u,onStarMessage:i,onEditMessage:c}))})),ne=Object(i.a)((function(e){return{root:{"&:hover":{backgroundColor:"#eee"}}}})),re=function(e){var t=ne();return s.a.createElement(l.a,{display:"flex",alignItems:"center",className:t.root},e.children,s.a.createElement(ae,e))},se=Object(m.connectCtx)(k)(void 0,(function(e){return{onDelete:function(t){var a=function(e){return{type:n.DELETE_MESSAGE,payload:{id:e}}}(t);e(a)}}}))((function(e){var t=e.message,a=e.onDelete,n=t.id,o=Object(r.useCallback)((function(){window.confirm("Are you sure delete?")&&a(n)}),[n,a]);return s.a.createElement(re,Object.assign({},e,{onDelete:o}))})),oe=function(e){return s.a.createElement(se,e,s.a.createElement(V.a,{color:"primary",onChange:e.onToggleTodo,checked:!!e.status.isDone}))},ce=Object(m.connectCtx)(k)(void 0,(function(e){return{toggleTodoActionFn:function(t,a){var r=function(e,t){return{type:n.TOGGLE_MESSAGE_ISDONE,payload:{id:e,isDone:t}}}(t,a);e(r)}}}))((function(e){var t=e.message,a=e.toggleTodoActionFn,n=t.id,o=Object(r.useCallback)((function(e,t){return a(n,t)}),[n,a]);return s.a.createElement(oe,Object.assign({},e,{onToggleTodo:o}))})),ie=a(286),ue=function(e){return s.a.createElement(se,e,s.a.createElement(ie.a,null))},le=function(e){var t=e.index,a=e.messageItemProps;switch(a.type){case E.TODO:return s.a.createElement(ce,Object.assign({key:t},a));case E.DEFAULT:return s.a.createElement(ue,Object.assign({key:t},a));default:return null}},ge=function(e){var t=e.messageList.filter((function(e){return e.message.isPin}));return s.a.createElement(P.a,{elevation:2},s.a.createElement(B.a,null,"Pin Messages"),t.map((function(e,t){return le({index:t,messageItemProps:e})})),s.a.createElement(U.a,null))},me=a(459),de=function(){function e(){Object(S.a)(this,e)}return Object(v.a)(e,null,[{key:"regDateToString",value:function(e){return new Date(e).toLocaleDateString()}},{key:"checkTwoDateIsSame",value:function(e,t){return!(!e||!t)&&(console.log(e,t),this.regDateToString(e)===this.regDateToString(t))}},{key:"convertToMessageWithDateList",value:function(e){for(var t="",a=-1,n=[{date:t,messageList:[]}],r=0;r<e.length;r++){var s=e[r],o=s.message.createdAt;this.checkTwoDateIsSame(o,t)||(t=o,a+=1),n[a]={date:t,messageList:[].concat(Object(f.a)(n[a]?n[a].messageList:[]),[s])}}return n}}]),e}(),fe=/^(\d+\/)/g,Ee=function(e){var t=new Date(e.date).toLocaleDateString().replace(fe,"");return s.a.createElement(B.a,{variant:"h5"},t)},Se=function(){function e(){Object(S.a)(this,e)}return Object(v.a)(e,null,[{key:"checkNewStrIsInStrList",value:function(e,t){return e.includes(t)}},{key:"checkNewStrListIsInStrList",value:function(e,t){if(0===t.length)return!0;for(var a=0;a<t.length;a++){var n=t[a];if(this.checkNewStrIsInStrList(e,n))return!0}return!1}},{key:"addNewStrToStrList",value:function(e,t){return this.checkNewStrIsInStrList(e,t)?e:[].concat(Object(f.a)(e),[t])}},{key:"addNewStrListToStrList",value:function(e,t){for(var a=e,n=0;n<t.length;n++){var r=t[n];a=this.addNewStrToStrList(a,r)}return a}},{key:"getTagNamesFromMessage",value:function(e){return e.message.tagList.map((function(e){return e.name}))}},{key:"getTagNoteBlockObj",value:function(e){for(var t=[],a={},n=0;n<e.length;n++){var r=e[n],s=this.getTagNamesFromMessage(r);t=this.addNewStrListToStrList(t,s);this.checkNewStrListIsInStrList(t,s);if(s.length>0){var o=s[0];a[o]?a[o]=Object(d.a)({},a[o],{messageList:[].concat(Object(f.a)(a[o].messageList),[r])}):a[o]={tagTitle:o,messageList:[r]}}}return a}}]),e}(),ve=function(e){return s.a.createElement(l.a,{paddingLeft:1.5},s.a.createElement(B.a,{variant:"h6",color:"textPrimary"},e.tagTitle),s.a.createElement(l.a,{paddingLeft:1.5},e.messageList.map((function(e,t){return le({index:t,messageItemProps:e})}))))},pe=function(e){return s.a.createElement(ve,e)},be=Object(i.a)((function(e){return{root:{borderRadius:4,borderColor:function(e){return e.selected?"#ddd":"transparent"},borderWidth:2,borderStyle:"solid"}}})),Oe=function(e){var t=e.date,a=e.messageList,n=be(e),r=Se.getTagNoteBlockObj(a),o=Object.keys(r);return s.a.createElement(s.a.Fragment,null,s.a.createElement(l.a,{padding:.5,paddingBottom:2,className:n.root},s.a.createElement(l.a,{paddingBottom:1},s.a.createElement(Ee,{date:t})),o.map((function(e,t){return s.a.createElement(pe,Object.assign({key:t},r[e]))}))))},he=function(e){return de.checkTwoDateIsSame(new Date,e)},Te=function(e){var t=e.messageList;if(0===t.length)return s.a.createElement(B.a,{variant:"h5",color:"textSecondary"},"No notes yet :>");var a=de.convertToMessageWithDateList(t);return s.a.createElement(l.a,null,a.map((function(e,t){return s.a.createElement(Oe,Object.assign({key:t},e,{selected:he(e.date)}))})))},Le=function(){var e=Object(r.useRef)(null),t=Object(r.useCallback)((function(){e.current&&e.current.scrollIntoView({block:"end"})}),[]);return{ref:e,handleScrollToView:t}},ye=function(e){var t=Le(),a=t.ref,n=t.handleScrollToView;return s.a.useEffect((function(){n()}),[e.messageList,n]),s.a.createElement(me.a,{rootRef:a},s.a.createElement(Te,e))},Me=Object(i.a)((function(){return{pinMessageListPart:{position:"sticky",top:0,maxHeight:200,overflow:"auto",zIndex:1e3,boxShadow:"0px 10px 10px rgba(0, 0, 0, 0.07)"},root:{}}})),De=function(e){var t=Me();return s.a.createElement(s.a.Fragment,null,s.a.createElement(l.a,{className:t.pinMessageListPart},s.a.createElement(ge,{messageList:e.messageList})),s.a.createElement(l.a,null,s.a.createElement(C,null),s.a.createElement(F,null)),s.a.createElement(ye,e))},ke=Object(m.connectCtx)(k)((function(e){return{messageList:e.messageList}}),(function(e){return{setMessageFromDB:function(){var t=O.getData();console.log(t);var a,r=(a=t,{type:n.SET_MESSAGE_FROM_DB,payload:{rawMessageFromDBList:a}});e(r)}}}))((function(e){var t=e.setMessageFromDB;return s.a.useEffect((function(){t()}),[t]),s.a.createElement(De,e)})),je=(a(426),Object(i.a)((function(e){return{root:{"&::-webkit-scrollbar":{width:8}},notePart:{maxHeight:"calc(100vh - 80px)",overflow:"auto"},inputPart:{position:"fixed",bottom:e.spacing(1),left:e.spacing(1),right:e.spacing(1)}}}))),we=function(){var e=je();return s.a.createElement(j,{customInitState:{}},s.a.createElement(u.a,null,s.a.createElement(l.a,{padding:1,className:e.root},s.a.createElement(l.a,{className:e.notePart},s.a.createElement(ke,null)),s.a.createElement(l.a,{className:e.inputPart},s.a.createElement(x,null)))))};var Ie=function(){return s.a.createElement(we,null)};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));c.a.render(s.a.createElement(s.a.StrictMode,null,s.a.createElement(Ie,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[346,1,2]]]);
//# sourceMappingURL=main.02567e53.chunk.js.map